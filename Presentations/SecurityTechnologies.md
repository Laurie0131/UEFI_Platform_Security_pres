@title[Security technologies overview Section]
<br><br><br><br><br><br><br>
### <span class="gold"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Security Technologies</span>
<span style="font-size:0.9em" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Security Technologies Overview ?</span>

Note:
  SecurityTechnologies.md for UEFI / EDK II Training  Security technologies overview

  Copyright (c) 2018, Intel Corporation. All rights reserved.<BR>

  Redistribution and use in source (original document form) and 'compiled'
  forms (converted to PDF, epub, HTML and other formats) with or without
  modification, are permitted provided that the following conditions are met:

  1) Redistributions of source code (original document form) must retain the
     above copyright notice, this list of conditions and the following
     disclaimer as the first lines of this file unmodified.

  2) Redistributions in compiled form (transformed to other DTDs, converted to
     PDF, epub, HTML and other formats) must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the distribution.

  THIS DOCUMENTATION IS PROVIDED BY TIANOCORE PROJECT "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
  EVENT SHALL TIANOCORE PROJECT  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
  OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
  OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF
  ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


---?image=assets/images/gitpitch-audience.jpg
@title[Boot Security Sub-section]
<br><br><br><br><br><br><br>
### <span class="gold"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Boot Securty</span>
<span style="font-size:0.9em" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>


---?image=/assets/images/slides/Slide83.JPG
@title[Boot Security Technologies]
<p align="right"><span class="gold" ><b>Boot Security Technologies</b></span></p>

Note:

##### Intel Boot Guard: 
- When your CPU starts up, it reads some code out of flash and executes it. With Intel Boot Guard, the CPU verifies a signature on that flash code before executing the reset vector

##### Intel TXT - Trusted Execution Technology 

##### Secure Boot
- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).

- Secure Boot is relatively self-contained. If the handful of signed objects haven’t been tampered with, the platform boots, and secure boot is done. If objects have been changed so the signature is no longer valid, the platform doesn’t boot and a re-installation is indicated.


##### Measured Boot
- In a Measured Boot chain, we still depend on a Root of Trust as the starting point for a chain of trust. But in this case, prior to launching the next object, the currently-running object “measures” or computes the hash of, the next object(s) in the chain, and stores the hashes in a way that they can be securely retrieved later to find out what objects were encountered. Measured Boot doesn’t make an implicit value judgement as to good or bad, and it doesn’t stop the platform from running, so Measured Boot can be much more liberal about what it checks. This can include all kinds of platform configuration information such as which was the boot device, what was in the loader config file, or anything else that might be of interest.

- Measured Boot is more flexible, but also requires an important step... Somehow all those hashes have to be stored in a way that there’s very little chance that they can be manipulated, and a very high likelihood that they can be reliably reported to a management station, using a process called Attestation. Since Measured Boot doesn’t stop the platform from booting, the host OS can’t be relied upon to report the hashes.
 
- In the case of Measure Boot, the Trusted Platform Module is used to record these hashes. The TPM is a small self-contained security processor that can be attached to a system bus as a simple peripheral. (See http://forums.juniper.net/t5/Security-Now/What-is-a-Trusted-Platform-Module-TPM/ba-p/281128 for more on TPM technology.)  Of the many functions a TPM can provide, one is the facility called Platform Configuration Registers (PCRs), used for storing hashes.

- PCRs are registers in the TPM that are cleared only at hardware reset, and cannot be directly written




---?image=/assets/images/slides/Slide85.JPG
@title[Hardware root of Trust ]
<p align="right"><span class="gold" ><b>Hardware root of Trust </b></span></p>

Note:
##### Intel Boot Guard: 
- With Intel Boot Guard, the CPU verifies a signature on flash code before executing. The hash of the public half of the signing key is flashed into fuses on the CPU. It is the system vendor that owns this key and chooses to flash it into the CPU, not Intel. 
- This has genuine security benefits. It's no longer possible for an attacker to simply modify or replace the firmware - they have to find some other way to trick it into executing arbitrary code, and over time these will be closed off. But in the process, the system vendor has prevented the user from being able to make an informed choice to replace their system firmware


##### Intel TXT Trusted Execution Technology 
- TXT - uses a Trusted Platform Module (TPM) and cryptographic techniques to provide measurements of software and platform components so that system software as well as local and remote management applications may use those measurements to make trust decisions. This technology is based on an industry initiative by the Trusted Computing Group (TCG) to promote safer computing. It defends against software-based attacks aimed at stealing sensitive information by corrupting system or BIOS code, or modifying the platform's configuration.



---?image=/assets/images/slides/Slide87.JPG
@title[Full Verified Boot Sequence ]
<p align="right"><span class="gold" ><b>Full Verified Boot Sequence </b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<span style="font-size:0.5em" >References : <a href="https://firmware.intel.com/sites/default/files/resources/Platform_Security_Review_Intel_Cisco_White_Paper.pdf">Platform_Security_Review PDF</a>, <a href="http://www.intel.com/content/dam/www/public/us/en/documents/product-briefs/4th-gen-core-family-mobile-brief.pdf">4th-gen-core-family PDF</a></span>

Note:
##### reference:
- https://firmware.intel.com/sites/default/files/resources/Platform_Security_Review_Intel_Cisco_White_Paper.pdf 
- http://www.intel.com/content/dam/www/public/us/en/documents/product-briefs/4th-gen-core-family-mobile-brief.pdf


- This slide is using the boot flow and pointing out the different boot security technologies

- In the slide, the platform hardware complex will provide logic to verify that the ensuing BIOS storage container meets the policy of the platform supplier. 
- Once this restart time verification occurs, the Platform Supplier (PS)  Platform Init (PI) code, such as the UEFI PEI phase, is responsible for ensuring that the rest of the Platform Supplier (PS) code meets policy. Today, the hardware action is Platform Supplier  and/or Hardware-supplier specific, and the ‘middle’ verification is Platform Supplier  specification. 

- In measured boot, a record of the code execution is provided into the PCR’s (in the TPM) but no policy decisions are enacted. Secure Boot, on the other hand, enforces policy prior to the execution of content. The code that implements the Secure Boot logic is known alternatively as a Root of Trust for Verification (RTV) or Root of Trust for Enforcement (RTE). 
- The RTV can be a hardware embodiment that  verifies the UEFI PI firmware prior to passing control or 

- it can be implemented in UEFI for purposes of providing platform owner control of UEFI 3rd party executables. 

- The later is described in this slide



---?image=/assets/images/slides/Slide89.JPG
@title[Boot Guard and TXT ]
<p align="right"><span class="gold" ><b>Boot Guard and TXT</b></span></p>

Note:

- Same as the previous slide with the combination of TXT & Boot Guard and uses with VMM after Host OS Boots

- Establishing a Trusted Environment (Intel provides 3 modes)
- Starts with Root of Trust for Measurement (RTM)

- Combining Verification with Measurement with TPM s


---?image=/assets/images/slides/Slide91.JPG
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).



+++?image=/assets/images/slides/Slide92.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot 02 ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).


+++?image=/assets/images/slides/Slide93.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot 03 ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).

+++?image=/assets/images/slides/Slide94.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot 04 ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).

+++?image=/assets/images/slides/Slide95.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot 05 ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).


+++?image=/assets/images/slides/Slide96.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot 06 ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot </b></span></p>

Note:
- New feature to use authenticated firmware variables as the OS loader “root of trust”
- Software ID checking at every step of boot
- System BIOS (updated via secure process)
- Add-In Cards (Signed UEFI Option ROMs)
- OS Boot Loader (checks for “secure mode” at boot)
- Secure Boot is not required by UEFI but bay be required by specific OS leveraging UEFI 2.3.1
- Example: Microsoft Windows 8 client

- In a Secure Boot chain, each step in the process checks a cryptographic signature on the executable of the next step before it’s launched. Thus, the BIOS will check a signature on the loader, and the loader will check signatures on all the kernel objects that it loads. The objects in the chain are usually signed by the software manufacturer, using private keys that match up with public keys already in the BIOS. If any of the software modules in the boot chain have been hacked, then the signatures won’t match, and the device won’t boot the image.Because the images must be signed by the manufacturer, it’s generally impractical to sign any files generated by the platform user (such as config files).



---?image=/assets/images/slides/Slide98.JPG
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow ]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide99.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 02]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide100.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 03]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide101.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 04]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide102.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 05]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide103.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 06]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide104.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 08]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


+++?image=/assets/images/slides/Slide105.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[UEFI Secure Boot Flow 09]
<p align="right"><span class="gold" ><b>UEFI Secure Boot Flow</b></span></p>

Note:
- UEFI Secure Boot defines how a platform’s firmware can authenticate a digitally signed UEFI image, such as an operating system loader or a UEFI driver stored in an option ROM. This provides the capability to ensure that those UEFI images are only loaded in an owner-authorized fashion and provides a common means to ensure platforms security and integrity over systems running UEFI-based firmware. 

- At a high level, the platform manufacturer or the platform owner are the administrative role on the left of this slide. They will enroll the policy objects, which include the n-tuple of keys {PK, KEK, db, dbx} as a step 1. During each successive boot, the UEFI Secure boot implementation will assess the policy in order to verify the signed images that are discovered in a host-bus adapter or on a disk. If the images pass policy, then they are invoked. 


---?image=/assets/images/slides/Slide107.JPG
<!-- .slide: data-transition="none" -->
@title[End to End Platform Integrity ]
<p align="right"><span class="gold" ><b>End to End Platform Integrity </b></span></p>
<br>
<br>
<span style="font-size:0.5em" >Reference: <br><a href="http://vzimmer.blogspot.com/2013/09/where-do-i-sign-up.html">Where do I 'sign' up?</a></span>

Note:
- This slide show  Intel (R) Device Protection Technology with Boot Guard surfaces from the system hardware and precedes execution of the PI SEC/PEI/DXE codes end-to-end integrity, though, so both protection of the underlying firmware and the run time are important
 
- Intel (R) Boot Guard and its "Verified Boot" versus UEFI Secure Boot,

- http://vzimmer.blogspot.com/2013/09/where-do-i-sign-up.html




+++?image=/assets/images/slides/Slide107.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[End to End Platform Integrity ]
<p align="right"><span class="gold" ><b>End to End Platform Integrity </b></span></p>
<br>
<br>
<span style="font-size:0.5em" >Reference: <br><a href="http://vzimmer.blogspot.com/2013/09/where-do-i-sign-up.html">Where do I 'sign' up?</a></span>

Note:


---?image=assets/images/gitpitch-audience.jpg
@title[Flash Device Sub-section]
<br><br><br><br><br><br><br>
### <span class="gold"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flash Device</span>
<span style="font-size:0.9em" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>


---?image=/assets/images/slides/Slide111.JPG
@title[BIOS Firmware uses SPI Flash]
<br>
<p align="left"><span class="gold" ><b>BIOS Firmware uses SPI Flash</b></span></p>

Note:

- Source: Intel 7 Series Chipset PCH datasheet : http://www.intel.com/content/dam/www/public/us/en/documents/datasheets/7-series-chipset-pch-datasheet.pdf

Bullets:
- Access controlled by the Peripheral Controller Hub (PCH)
- Flash Memory  - Direct access to physical address space is programed through SPI MMIO registers
- SPI Flash Descriptor  - Access Control table defines which masters (CPU, ME, GbE) can access which regions


- Where is BIOS Firmware Memory located?

##### SPI Flash Descriptor
- Region 0 at FLA 0 – FFFh (4 KB)
- Signature: 0FF0A55Ah at 10h LBA
- Contains the following sections:
  - Component: flash device configuration
  - Region: describes other regions
  - Master: defines Rd/Wr Access Control table
  - CPU and PCH soft straps
  - ME VSCC Table: JEDEC ID & VSCC info
  - OEM: reserved for OEM use
- Access Control table defines which masters (CPU, ME, GbE) can access which regions

##### Flash Descriptor has to be write-protected


- The maximum size of the Flash Descriptor is 4 KB. If the block/sector size of the SPI
flash device is greater than 4 KB, the flash descriptor will only use the first 4 KB of the
first block. The flash descriptor requires its own block at the bottom of memory (00h).
The information stored in the Flash Descriptor can only be written during the
manufacturing process as its read/write permissions must be set to Read only when the
computer leaves the manufacturing floor.

---
@title[System Flash Security ]
<p align="right"><span class="gold" ><b>System Flash Security </b></span></p>
<span style="font-size:0.9em" >Chipset (SPI controller) based protections</span>
<ul>
  <li><span style="font-size:0.9em" >SMM based BIOS Write Protection: write-protects entire BIOS/Firmware region from software other than SMI handler firmware executing in SMM</span>  </li>
  <li><span style="font-size:0.9em" >SPI Protected Range registers(`PR0-PR4`) : read/write protection of SPI flash regions based on Flash Linear Address  for program register access</span>  </li>
  <li><span style="font-size:0.9em" >Flash Descriptor based access control: defines read/write access to each flash region by each master</span>  </li>
</ul>
<br>
<span style="font-size:0.9em" >Firmware may use SPI flash chips write protection(`WP#`)</span>
<br>
<br>
<span style="font-size:0.9em" >`PR0-PR4` defined in SPI MMIO </span>

Note:

- How do we protect the SPI Device?

- SMM based BIOS Write Protection
- SPI Protected Range registers
- Flash Descriptor based access control

---
@title[Lock SPI - BIOS Range is not protected - Threats ]
<p align="right"><span class="gold" ><b>Lock SPI <br>- BIOS Range is not protected - Threats</b></span></p>
<ul>
  <li><span style="font-size:0.8em" >BIOS Write Protections often still not properly enabled on many systems</span>  </li>
  <li><span style="font-size:0.8em" >SMM based write protection of entire BIOS region is often not used: BIOS_CONTROL[SMM_BWP]</span>  </li>
  <li><span style="font-size:0.8em" >If SPI Protected Ranges (mode agnostic) are used (defined by `PR0-PR4` in SPI MMIO), they often don’t cover entire BIOS & NVRAM</span>  </li>
  <li><span style="font-size:0.8em" >Some platforms use SPI device specific write protection but only for boot block/startup code or SPI Flash descriptor region</span>  </li>
</ul>
<span style="font-size:0.9em" >Mitigations: </span>
<ul>
  <li><span style="font-size:0.8em" >Set BIOS_CONTROL[SMM_BWP] `<- 1`</span>  </li>
  <li><span style="font-size:0.8em" >Program SPI flash protected ranges (`PRx`) to cover BIOS range</span>  </li>
</ul>

<span style="font-size:0.5em" >References: <a href="http://phrack.org/issues/66/7.html"> Persistent BIOS Infection</a> (used <a href="Http://flashrom.org/Flashrom">flashrom </a>
on legacy BIOS), <a href="https://cansecwest.com/slides/2013/Evil Maid Just Got Angrier.pdf">Evil Maid Just Got Angrier</a>, <a href="https://media.blackhat.com/us-13/US-13-Butterworth-BIOS-Security-Slides.pdf">BIOS Chronomancy</a>, 
<a href="https://media.blackhat.com/us-13/us-13-Bulygin-A-Tale-of-One-Software-Bypass-of-Windows-8-Secure-Boot-Slides.pdf">A Tale Of One Software Bypass...</a> </span>


---?image=assets/images/gitpitch-audience.jpg
@title[Firmware Secure Update Sub-section]
<br><br><br><br><br><br><br>
### <span class="gold"  >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Firmware Secure Update</span>
<span style="font-size:0.9em" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>



+++?image=/assets/images/slides/Slide115.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Solving Firmware Update]
<p align="right"><span class="gold" ><b>Solving Firmware Update</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<span style="font-size:0.5em" >Reference [6] at : <a href="https://firmware.intel.com/blog/security-technologies-and-minnowboard-max?page=1">UEFI, Open Platforms</a> and <a href=" https://cansecwest.com/slides/2015/UEFI%20open%20platforms_Vincent.pptx">ppt</a></span>



Note:
- reference: UEFI open platforms_Vincent.ppt slide 24  - CanSecWest 2015 -  Refrences [6]: https://firmware.intel.com/blog/security-technologies-and-minnowboard-max?page=1

##### Reliable update story
- Fault tolerant
- Scalable & repeatable
##### How can UEFI Help?
- Capsule model for binary delivery
- Bus / Device Enumeration
- Managing updates via 
  - EFI System Resource Table 
  - Firmware Management Protocol
  - Capsule Signing



---

If we think of FW like plumbing
It needs to  standardized to simplify implementation  (Fitting the pieces of pipe together like standardized plumbing PVC Pipe)
Where we have the Hardware,  the Firmware,  and then hand off to the OS

When we look at why firmware security is important, using the analogy of the plumbing pipeline,
If we are were to run water through this imaginary pipe we would want to know that the water source could be trusted
With Security it is important to establish the root of trust and that we can validated that root of trust.
And it needs to be scalable to work across a variety of needs

New Ideas – new features - 
Dog do-do - Protect from outside attacks. Protect from Things not intended to be put into the firmware

Firmware needs to be done correctly from the get -go


+++?image=/assets/images/slides/Slide5.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Why is Platform Firmware Security Important ? 02]
<p align="right"><span class="gold" ><b>Why is Platform Firmware  <br>Security Important ?</b></span></p>



Note:

If we think of FW like plumbing
It needs to  standardized to simplify implementation  (Fitting the pieces of pipe together like standardized plumbing PVC Pipe)
Where we have the Hardware,  the Firmware,  and then hand off to the OS

When we look at why firmware security is important, using the analogy of the plumbing pipeline,
If we are were to run water through this imaginary pipe we would want to know that the water source could be trusted
With Security it is important to establish the root of trust and that we can validated that root of trust.
And it needs to be scalable to work across a variety of needs

New Ideas – new features - 
Dog do-do - Protect from outside attacks. Protect from Things not intended to be put into the firmware

Firmware needs to be done correctly from the get -go



+++?image=/assets/images/slides/Slide6.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Why is Platform Firmware Security Important ? 03]
<p align="right"><span class="gold" ><b>Why is Platform Firmware <br> Security Important ?</b></span></p>



Note:

If we think of FW like plumbing
It needs to  standardized to simplify implementation  (Fitting the pieces of pipe together like standardized plumbing PVC Pipe)
Where we have the Hardware,  the Firmware,  and then hand off to the OS

When we look at why firmware security is important, using the analogy of the plumbing pipeline,
If we are were to run water through this imaginary pipe we would want to know that the water source could be trusted
With Security it is important to establish the root of trust and that we can validated that root of trust.
And it needs to be scalable to work across a variety of needs

New Ideas – new features - 
Dog do-do - Protect from outside attacks. Protect from Things not intended to be put into the firmware

Firmware needs to be done correctly from the get -go



+++?image=/assets/images/slides/Slide7.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Why is Platform Firmware Security Important ? 04]
<p align="right"><span class="gold" ><b>Why is Platform Firmware <br>Security Important ?</b></span></p>



Note:

If we think of FW like plumbing
It needs to  standardized to simplify implementation  (Fitting the pieces of pipe together like standardized plumbing PVC Pipe)
Where we have the Hardware,  the Firmware,  and then hand off to the OS

When we look at why firmware security is important, using the analogy of the plumbing pipeline,
If we are were to run water through this imaginary pipe we would want to know that the water source could be trusted
With Security it is important to establish the root of trust and that we can validated that root of trust.
And it needs to be scalable to work across a variety of needs

New Ideas – new features - 
Dog do-do - Protect from outside attacks. Protect from Things not intended to be put into the firmware

Firmware needs to be done correctly from the get -go





---?image=/assets/images/slides/Slide9.JPG
<!-- .slide: data-transition="none" -->
@title[Why???    Security]
<p align="right"><span class="gold" ><b>Why???    Security</b></span></p>

Note:


- Broken Bottle source CC : https://www.1001freedownloads.com/free-clipart/broken-bottle
- Safe http://www.clipartkid.com/images/252/free-to-use-public-domain-miscellaneous-clip-art-page-41-jsgFX2-clipart.png

- Network attacks 
- Take the preboot execution environment and get bios-level access to the hardware from across the network, outside any control of the on-disk operating system. The pxesploit attack, releasing a new metasploit-based comprehensive PXE attack toolkit to deliver any payload reliably to many different operating systems. 

- Code Injection Attacks
- Important when firmware verifies digital signature
- Depends on implementation flaw in a driver 
- E.g. Stack overflow, heap overflow or incorrect signature verification
- Secure Boot prevents running an unknown OS loader



+++?image=/assets/images/slides/Slide10.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->

@title[Why???    Security 02]
<p align="right"><span class="gold" ><b>Why???    Security</b></span></p>

Note:


- Broken Bottle source CC : https://www.1001freedownloads.com/free-clipart/broken-bottle
- Safe http://www.clipartkid.com/images/252/free-to-use-public-domain-miscellaneous-clip-art-page-41-jsgFX2-clipart.png

- Network attacks 
- Take the preboot execution environment and get bios-level access to the hardware from across the network, outside any control of the on-disk operating system. The pxesploit attack, releasing a new metasploit-based comprehensive PXE attack toolkit to deliver any payload reliably to many different operating systems. 

- Code Injection Attacks
- Important when firmware verifies digital signature
- Depends on implementation flaw in a driver 
- E.g. Stack overflow, heap overflow or incorrect signature verification
- Secure Boot prevents running an unknown OS loader




+++?image=/assets/images/slides/Slide11.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->

@title[Why???    Security 03]
<p align="right"><span class="gold" ><b>Why???    Security</b></span></p>

Note:


- Broken Bottle source CC : https://www.1001freedownloads.com/free-clipart/broken-bottle
- Safe http://www.clipartkid.com/images/252/free-to-use-public-domain-miscellaneous-clip-art-page-41-jsgFX2-clipart.png

- Network attacks 
- Take the preboot execution environment and get bios-level access to the hardware from across the network, outside any control of the on-disk operating system. The pxesploit attack, releasing a new metasploit-based comprehensive PXE attack toolkit to deliver any payload reliably to many different operating systems. 

- Code Injection Attacks
- Important when firmware verifies digital signature
- Depends on implementation flaw in a driver 
- E.g. Stack overflow, heap overflow or incorrect signature verification
- Secure Boot prevents running an unknown OS loader



+++?image=/assets/images/slides/Slide12.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->

@title[Why???    Security 04]
<p align="right"><span class="gold" ><b>Why???    Security</b></span></p>

Note:


- Broken Bottle source CC : https://www.1001freedownloads.com/free-clipart/broken-bottle
- Safe http://www.clipartkid.com/images/252/free-to-use-public-domain-miscellaneous-clip-art-page-41-jsgFX2-clipart.png

- Network attacks 
- Take the preboot execution environment and get bios-level access to the hardware from across the network, outside any control of the on-disk operating system. The pxesploit attack, releasing a new metasploit-based comprehensive PXE attack toolkit to deliver any payload reliably to many different operating systems. 

- Code Injection Attacks
- Important when firmware verifies digital signature
- Depends on implementation flaw in a driver 
- E.g. Stack overflow, heap overflow or incorrect signature verification
- Secure Boot prevents running an unknown OS loader



+++?image=/assets/images/slides/Slide13.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->

@title[Why???    Security 05]
<p align="right"><span class="gold" ><b>Why???    Security</b></span></p>

Note:


- Broken Bottle source CC : https://www.1001freedownloads.com/free-clipart/broken-bottle
- Safe http://www.clipartkid.com/images/252/free-to-use-public-domain-miscellaneous-clip-art-page-41-jsgFX2-clipart.png

- Network attacks 
- Take the preboot execution environment and get bios-level access to the hardware from across the network, outside any control of the on-disk operating system. The pxesploit attack, releasing a new metasploit-based comprehensive PXE attack toolkit to deliver any payload reliably to many different operating systems. 

- Code Injection Attacks
- Important when firmware verifies digital signature
- Depends on implementation flaw in a driver 
- E.g. Stack overflow, heap overflow or incorrect signature verification
- Secure Boot prevents running an unknown OS loader



---?image=/assets/images/slides/Slide15.JPG
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module



+++?image=/assets/images/slides/Slide16.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 02]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module



+++?image=/assets/images/slides/Slide17.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 03]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module


+++?image=/assets/images/slides/Slide18.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 04]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module


+++?image=/assets/images/slides/Slide19.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 05]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module


+++?image=/assets/images/slides/Slide20.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 06]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module


+++?image=/assets/images/slides/Slide21.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Firmware Everywhere 07]
<p align="right"><span class="gold" ><b>Firmware Everywhere</b></span></p>

Note:

- BLOCK Diagram of a Platform
- We see that Firmware is everywher
- GBe NIC, WiFi, Bluetooth, WiGig
- Baseband (3G, LTE) Modems
- Sensor Hubs
- NFC, GPS Controllers
- HDD/SSD
- Keyboard and Embedded Controllers
- Battery Gauge
- Baseboard Management Controllers (BMC)
- Graphics/Video
- USB Thumb Drives, keyboards/mice
- Chargers, adapters
- TPM, security coprocessors
- Routers, network appliances
- Main system firmware (BIOS, UEFI firmware, coreboot)

  -   GBe - Gigabit Network Interface controller
  - NFC   Near Field Communication
  -   GPS	Global Positioning System
  - HDD/SSD Hard Drive - Solid State Drive
  -   TPM    Trusted Platform Module



---?image=/assets/images/slides/Slide23.JPG
@title[Where is UEFI firmware?]
<p align="right"><span class="gold" ><b>Where is UEFI firmware?</b></span></p>

Note:

- https://firmware.intel.com/blog/security-technologies-and-minnowboard-max?page=1 
- UEFI open platforms_Vincent.ppt slide 12  - CanSecWest 2015 -  Refrences [6]: reference # [6] Slide 12 of PPT

- SOFTWARE STACK
- Specific examples




---?image=/assets/images/slides/Slide25.JPG
@title[In-the-wild Firmware Attacks]
<br>
<p align="left"><span class="gold" ><b>In-the-wild <br>Firmware Attacks</b></span></p>
<div class="left1">
<ul>
  <li><span style="font-size:0.8em" >Legacy Bootkits ( <a href="http://cdn5.esetstatic.com/eset/US/resources/docs/white-papers/white-papers-when-im-x64-bootkit-threat-evolution-2011.pdf">TDL4</a> , <a href="http://www.welivesecurity.com/wp-content/uploads/2013/04/gapz-bootkit-whitepaper.pdf">Gapz</a>. . .)</span>  </li>
  <li><span style="font-size:0.8em" ><a href="http://www.webroot.com/blog/2011/09/13/mebromi-the-first-bios-rootkit-in-the-wild/">Mebromi BIOS rootkit</a></span>  </li>
  <li><span style="font-size:0.8em" ><a href="https://www.virusbulletin.com/uploads/pdf/conference_slides/2010/OMurchu-VB2010.pdf">Stuxnet</a></span>  </li>
  <li><span style="font-size:0.8em" ><a href="https://securelist.com/files/2015/02/Equation_group_questions_and_answers.pdf">EQUATION Group </a>HDD firmware malware </span>  </li>
  <li><span style="font-size:0.8em" ><a href="http://www.intelsecurity.com/advanced-threat-research/content/data/HT-UEFI-rootkit.html">Hacking Team [ UEFI rootkit]</a></span>  </li>
  <li><span style="font-size:0.8em" ><a href="https://blog.malwarebytes.org/threat-analysis/2016/04/petya-ransomware/">Petya</a>MBR Ransomware</span>  </li>
  <li><span style="font-size:0.8em" >Legitimate BIOS “backdoors”: SuperFish, Computrace</span>  </li>
</ul>
</div>
<div class="right1">
<span style="font-size:01.0em" ><font color="cyan">&nbsp;</font></span>
</div>


Note:
- http://d2mlnkprj9wd81.cloudfront.net/sites/default/files/images/resource-centre/IFAW%20Wild%20Tiger.jpg
- http://www.ifaw.org/international/our-work/cats-and-dogs/creative-commons 
- Legacy:
	- TDL4 - trojan and bootkit created to steal data by intercepting a system's network traffic and searching for: banking usernames and passwords, credit card data, PayPal information, social security numbers, and other sensitive user data.[1] Following a series of customer complaints, Microsoft determined that Alureon caused a wave of BSoDs on some 32-bit Microsoft Windows systems. The update, MS10-015,[2] triggered these crashes by breaking assumptions made by the malware author(s).[

- TDL-4 is sometimes used synonymously with Alureon and is also the name of the rootkit that runs the botnet.

- Gapz_ For those who are curious why this threat is named Win32/Gapz here is the answer: the tag ‘GAPZ’ is used throughout all the binaries and shellcode for allocating memory. 
- Mebromi: 2011
- The infection starts with a small encrypted dropper that contains five crypted resource files: hook.rom, flash.dll, cbrom.exe, my.sys, bios.sys. The goal of these files will be presented later in this analysis.

- Stuxnet: 2010 Stuxnet is Targeted Targeting a Specific type of PLC Searches for a Specific Configuration - Stuxnet’s version intercepts
- reads and writes to the PLC

- EQUATION Group: 2001: 
- The Equation group is a highly sophisticated threat actor that has been engaged in multiple CNE (computer network exploitation) operations dating back to 2001, and perhaps as early as 1996. The Equation group uses multiple malware platforms, some of which surpass the well-known “Regin” threat in complexity and sophistication. The Equation group is probably one of the most sophisticated cyber attack groups in the world; and they are the most advanced threat actor we have seen. 

- Equation group because of their love for encryption algorithms and obfuscation strategies and the sophisticated methods used throughout their operations. 

- HackingTeam's UEFI Rootkit Details: Intel's Advanced Threat Research team (ATR) is the presence of what appears to be a UEFI-based persistent infection mechanism. ATR has been researching vulnerabilities related to system firmware and working with a community of firmware developers and platform manufacturers to mitigate these threats

- Petya MBR Ransomware- 2016 -  Petya’s ransom note states that it encrypts the full disk, but this is not true. Instead, it encrypts the master file table (MFT) so that the file system is not readable.

- SuperFish is a piece of software that is Pre-installed on some Lenovo computers. This software can break the HTTPS encryption used when the web browser on your computer communicates with websites that use the HTTPS protocol to protect sensitive information.Dec 1, 2015

- Computrace is software built into program laptops that were purchased as part of MCLA's Laptop Initiative. In the event your laptop is stolen, the Computrace software tracks the stolen computer and provides local police with the information they need to get it back.

 


---?image=/assets/images/slides/Slide27.JPG
@title[Why Attack Firmware?]
<p align="center"><span class="gold" ><b>Why Attack Firmware?</b></span></p>

Note:
- Brick 
- source: http://www.clipartpanda.com/clipart_images/brick-by-brick-clipart-1-71284827

- Firmware Attack Methods
- Categorize the different methods
- Why We are HERE!!!

- There are examples in the real world about attacks in each of these categories 




---?image=/assets/images/slides/Slide29.JPG
@title[Extreme Persistence]
### <p align="right"><span class="gold" ><b>Extreme Persistence</b></span></p>

Note:

- http://www.google.com/url?sa=i&rct=j&q=&esrc=s&source=images&cd=&cad=rja&uact=8&ved=0ahUKEwjg-8-9tY7TAhVSx2MKHZN2CpgQjRwIBw&url=http%3A%2F%2Fwww.elainebaileyinternational.com%2Fwordpress%2Fcategory%2Faccountability%2F&bvm=bv.151426398,d.cGc&psig=AFQjCNGTmCTOJCSqC446pVthXLAKMrSKoA&ust=1491519553033668



- User mode backdoor
- Kernel mode backdoor

- BIOS Level Back Door

- Takes control before any other software
- Stealth behavior
- Generally forgotten by almost all Antiviruses
- OS Independent (Runs outside the OS context)

### on the slide
- System firmware rootkit (in SMM or BIOS/UEFI)
- Replaces OS boot loader every boot

- Which patches OS kernel
- Firmware rootkit is protected by the hardware write protections
- Only way to fully remove the infection is to physically re-flash the flash “ROM” chip




---?image=/assets/images/slides/Slide31.JPG
@title[Stealth]
<br>
#### <p align="left"><span class="gold" ><b>Stealth</b></span></p>

Note:
#### Is Security Software real protection?

- Stealth CC
- https://farm1.staticflickr.com/8/7227778_c10e26cb79_o_d.jpg

-Security software usually doesn’t monitor ALL firmware on the platform
-How can software reliably tell infected from good firmware (FALSE - POSITIVE)
-Devices use obscure hardware interfaces to their firmware
-Which tool do we use to find BIOS/UEFI infection? And rootkit in firmware of SSD, NIC, EC, BMC, modem, USB thumb-drive, battery gauge, charger?




---?image=/assets/images/slides/Slide33.JPG
<!-- .slide: data-transition="none" -->
@title[Bypass Software Security – Full Disk ]
<p align="right"><span class="gold" ><b>Bypass Software Security – Full Disk</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<span style="font-size:0.5em" ><a href="https://cansecwest.com/slides/2013/Evil%20Maid%20Just%20Got%20Angrier.pdf">Source</a>: Evil Maid Just Got Angrier: Why Full-Disk Encryption with TPM is not Secure on Many Systems</span>

Note:
- Security features like Full-Disk Encryption solutions rely on protections of the underlying firmware and hardware. Often system firmware (BIOS) doesn't use or incorrectly configures protections offered by hardware. 

- The PDF Link  demonstrates that software Full-Disk Encryption solutions are still subject to Evil Maid attacks when firmware fails to correctly utilize hardware protections, even when they rely on Trusted Platform Module to protect contents on the system drive from attacks that tamper with system firmware.



#### The PROBLEM
- Startup UEFI BIOS firmware at reset vector is inherently trusted
- To initiate chain of measurements or signature verification
- But it's firmware and can be updated

- If subverted or interrupted , all measurements in the chain can be forged - allowing firmware modifications to go undetected



#### Solution:
-  Just let BitLocker rely on all platform manufacturers to protect the UEFI
- BIOS from programmable SPI writes by malware,   and allow only signed UEFI BIOS updates, 



- protect authorized update software, 
- update the boot block (SEC/PEI code) securely, 
- correctly program and protect SPI Flash descriptor, 
- lock the SPI controller conguration, 
- AND NO BUGS ....

- Evil Maid 
- Attack Outline Against Encrypted OS Drive

1. While the owner is not watching and system is shut down.. 
2. adversary plugs in and boots into a USB thumb drive
3. which auto launches exploit directly modifying UEFI BIOS in unprotected SPI Flash
4. Gets out until owner notices someone is messing with the system 
5. Upon next boot, patched UEFI BIOS sends expected ’good’






+++?image=/assets/images/slides/Slide34.JPG
<!-- .slide: data-background-transition="none" -->
<!-- .slide: data-transition="none" -->
@title[Bypass Software Security – Full Disk 02 ]
<p align="right"><span class="gold" ><b>Bypass Software Security – Full Disk</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p align="right"><span style="font-size:0.5em" ><a href="https://cansecwest.com/slides/2013/Evil%20Maid%20Just%20Got%20Angrier.pdf">Source</a>: Evil Maid Just Got Angrier: Why Full-Disk Encryption with TPM is not Secure on Many Systems</span></p>

Note:
- Security features like Full-Disk Encryption solutions rely on protections of the underlying firmware and hardware. Often system firmware (BIOS) doesn't use or incorrectly configures protections offered by hardware. 

- The PDF Link  demonstrates that software Full-Disk Encryption solutions are still subject to Evil Maid attacks when firmware fails to correctly utilize hardware protections, even when they rely on Trusted Platform Module to protect contents on the system drive from attacks that tamper with system firmware.



#### The PROBLEM
- Startup UEFI BIOS firmware at reset vector is inherently trusted
- To initiate chain of measurements or signature verification
- But it's firmware and can be updated

- If subverted or interrupted , all measurements in the chain can be forged - allowing firmware modifications to go undetected



#### Solution:
-  Just let BitLocker rely on all platform manufacturers to protect the UEFI
- BIOS from programmable SPI writes by malware,   and allow only signed UEFI BIOS updates, 



- protect authorized update software, 
- update the boot block (SEC/PEI code) securely, 
- correctly program and protect SPI Flash descriptor, 
- lock the SPI controller conguration, 
- AND NO BUGS ....

- Evil Maid 
- Attack Outline Against Encrypted OS Drive

1. While the owner is not watching and system is shut down.. 
2. adversary plugs in and boots into a USB thumb drive
3. which auto launches exploit directly modifying UEFI BIOS in unprotected SPI Flash
4. Gets out until owner notices someone is messing with the system 
5. Upon next boot, patched UEFI BIOS sends expected ’good’






---?image=/assets/images/slides/Slide36.JPG
@title[Bypass Software Security – UEFI Secure Boot ]
<p align="right"><span class="gold" ><b>Bypass Software Security – UEFI Secure Boot</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p align="right"><span style="font-size:0.5em" ><a href="https://media.blackhat.com/us-13/us-13-Bulygin-A-Tale-of-One-Software-Bypass-of-Windows-8-Secure-Boot-Slides.pdf">Source</a>: A Tale of One Software Bypass of Windows Secure Boot</span></p>

Note:

- The UEFI specification defines secure booting of the operating system, helping protect against bootkits and other boot time attacks. However, robust implementation of Secure Boot in the system firmware is not always trivial and mistakes in the implementation can undermine protections offered by Secure Boot. 

- In Windows systems  UEFI Secure Boot is an important step towards securing platforms from malware compromising boot sequence before the OS. However, there are certain mistakes platform vendors sometimes make which can completely undermine protections offered by Secure Boot. 

- The linked PDF will demonstrate an example of full software bypass of Windows 8 Secure Boot due to such mistakes on some of the latest platforms and explain how those mistakes can be avoided

- So UEFI firmware updates are signed but firmware is directly writeable in SPI flash? So is NVRAM with EFI variables. Hmm… What could go wrong? 
- Hint: Malware could patch DXE Image Verification driver in ROM or it could change persistent Secure Boot keys/configuration in NVRAM 

- Malware could patch the NvRam Variable “SecureBoot”

- Source: A Tale of One Software Bypass of Windows Secure Boot : https://media.blackhat.com/us-13/us-13-Bulygin-A-Tale-of-One-Software-Bypass-of-Windows-8-Secure-Boot-Slides.pdf 




---?image=/assets/images/slides/Slide38.JPG
@title[Bypass Software Security – Virtual Machine Manager ]
<p align="right"><span class="gold" ><b>Bypass Software Security <br>– Virtual Machine Manager</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p align="right"><span style="font-size:0.5em" ><a href="http://www.intelsecurity.com/advanced-threat-research/content/AttackingHypervisorsViaFirmware_bhusa15_dc23.pdf">Source</a>: Attacking Hypervisors via Firmware and Hardware</span></p>

Note:

- http://www.intelsecurity.com/advanced-threat-research/content/AttackingHypervisorsViaFirmware_bhusa15_dc23.pdf

- VMM Isolation there is an assumed protection

- The PDF Link is a  research presentation that builds on a study  of hypervisor implementations as well as vulnerabilities in system firmware. 
- If the hypervisor does not fully isolate the system firmware from attacks within a guest VM, security issues in the underlying system may be exposed. 

- This research presented multiple real-world bypasses of hypervisor security using already-known firmware vulnerabilities that happened to be exposed.

- Software Isolation 
- CPU / SoC: traps to hypervisor (VM Exits), MSR & I/O permissions bitmaps, rings (PV)… 
- Memory / MMIO: hardware page tables (e.g. EPT, NPT), software shadow page tables 

- Devices Isolation 
- CPU / SoC: interrupt remapping 
- Memory / MMIO: IOMMU, No-DMA ranges 


- Protecting Memory with HW Assisted Paging 

#### VMM “forensics” 
- With the help of a rootkit in firmware any VM guest can extract all information about hypervisor and other VMs … and just from memory 
  - VMCS structures, MSR and I/O bitmaps for each VM guest 
  - EPT for each VM guest 
  - Regular page tables for hypervisor and each VM guest 
  - IOMMU pages tables for each IOMMU device 
  - Full hypervisor memory map, VM exit handler… 
  - Real hardware configuration (registers for real PCIe devices, MMIO contents…) 


- Did you know that VMMs emulate virtual devices of other VMMs? 

- Exploiting firmware SMI handler to attack VMM 

- Attacking VMM by proxying through SMI handler 

####  flashed rootkited
- We flashed rootkited part of firmware image from within a root partition to install the rootkit 
- The system doesn’t properly protect firmware in SPI flash memory so we could bypass write-protection 
- Finally more systems protect firmware on the flash memory 
  - common.bios_wp - CHIPSEC module to test write-protection 
- Malware can exploit vulnerabilities in firmware to install a rootkit on such systems 

#### Sometimes attacker doesn’t need a vulnerability in firmware…
- When VMM grants VM direct access to firmware or hardware interfaces 
- VM exploit doesn’t always need to exploit firmware first through these interfaces 
- It may use firmware or hardware as a confused deputy and attack VMM through some function on behalf of firmware



---?image=/assets/images/slides/Slide40.JPG
@title[Unfettered Access to Hardware - DRAM ]
<p align="right"><span class="gold" ><b>Unfettered Access to Hardware - DRAM</b></span></p>
<p align="right"><span style="font-size:0.5em" ><a href="http://www.syssec-project.eu/media/page-media/23/syssec2011-s1.4-sang.pdf">Source</a> :I/O Attacks in <br>Intel-PC Architecture ...</span></p>


Note:

#### Direct Memory Access  DMA mechanism

- A DMA attack is a type of side channel attack in computer security, in which an attacker can penetrate a computer or other device, by exploiting the presence of high-speed expansion ports that permit direct memory access ("DMA").
 
- DMA is included in a number of connections, because it lets a connected device (such as a camcorder, network card, storage device or other useful accessory or internal PC card) transfer data between itself and the computer at the maximum speed possible, by using direct hardware access to read or write directly to main memory without any operating system supervision or interaction. 

- The legitimate uses of such devices have led to wide adoption of DMA accessories and connections, but an attacker can equally use the same facility to create an accessory that will connect using the same port, and can then potentially gain direct access to part or all of the physical memory address space of the computer, bypassing all OS security mechanisms and any lock screen, to read all that the computer is doing, steal data or cryptographic keys, install or run spyware and other exploits, or modify the system to allow backdoors or other malware.



- What does Direct Memory Access mechanism stand for ?
- I/O mechanism that enables an I/O controller
- to perform directly a data transfer to/from the main memory without OS
- to offload the CPU of these transfers
- relies on a dedicated DMA engine

- Examples of I/O controllers using DMA:
network controllers (WiFi, Ethernet, . . . )
  - ! e.g., to transfer network frames into/from the main memory disk controllers
  - ! e.g., to transfer files into/from the main memory
- graphic controllers
  - ! e.g., to transfer textures, buffer objects from the main memory 5/

- DMA attacks aiming at the main memory:
  - attack (confidentiality & integrity) on software components
  - modifications made in the main memory can be detected

- Examples: [Dornseif 04, Becher 05, Carrier 04, Nick L. Petroni 04,
- Maynor 05, Boileau 06, Duflot 07, Duflot 10, Aumaitre 09, Piegdon 07


#### Mitigations
-Physical security – 
-Secure boot
-IOMMU – I/O Memory Management Unit – Intel® VT-d can use them to block I/O transactions that have not been allowed. However,    IOMMUs mostly are used instead to give guest virtual machines passthrough access to host hardware.
- OS selectively locking out devices
- Never allow sensitive data to be stored in Memory unencrypted


- Source: I/O Attacks in Intel-PC Architecture and Countermeasures by F. Lone Sang et al
- http://www.syssec-project.eu/media/page-media/23/syssec2011-s1.4-sang.pdf





---?image=/assets/images/slides/Slide42.JPG
@title[Unfettered Access to Hardware - DRAM ]
<p align="right"><span class="gold" ><b>Unfettered Access to Hardware - DRAM</b></span></p>
<p align="right"><span style="font-size:0.5em" ><a href="http://www.syssec-project.eu/media/page-media/23/syssec2011-s1.4-sang.pdf">Source</a> :I/O Attacks in <br>Intel-PC Architecture ...</span></p>



Note:

- Source: I/O Attacks in Intel-PC Architecture and Countermeasures by F. Lone Sang et al
- http://www.syssec-project.eu/media/page-media/23/syssec2011-s1.4-sang.pdf


####  Direct Memory Access  DMA mechanism

- A DMA attack is a type of side channel attack in computer security, in which an attacker can penetrate a computer or other device, by exploiting the presence of high-speed expansion ports that permit direct memory access ("DMA").

- DMA attacks aiming at I/O controllers’ internal memory:
  - exploit I/O controllers’ ressources (memory, features, . . . )
  - no modifications in the main memory, hard to detect
    - Examples: [Dornseif 04, Triulzi 08, Triulzi 10, Lone Sang 11a]

#### Mitigations
-Physical security – 
-Secure boot
-IOMMU – I/O Memory Management Unit – Intel® VT-d can use them to block I/O transactions that have not been allowed. However,    IOMMUs mostly are used instead to give guest virtual machines passthrough access to host hardware.
- OS selectively locking out devices
- Never allow sensitive data to be stored in Memory unencrypted



---?image=/assets/images/slides/Slide44.JPG
@title[Unfettered Access to Hardware – HDD/SSD ]
<br>
<p align="right"><span class="gold" ><b>Unfettered Access to Hardware – HDD/SSD</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<p align="right"><span style="font-size:0.5em" ><a href="http://www.pcworld.com/article/2884952/equation-cyberspies-use-unrivaled-nsastyle-techniques-to-hit-iran-russia.html">Source</a> : PC World – Destroying your hard drive is the only<br> way to stop this super advanced malware</span></p>

Note:

- A cyberespionage group with a toolset similar to ones used by U.S. intelligence agencies has infiltrated key institutions in countries including Iran and Russia, utilizing a startlingly advanced form of malware that is impossible to remove once it's infected your PC

- From PC WORLD

- Kaspersky Lab released a report in Feb 2015,  that said the tools were created by the “Equation” group, which it stopped short of linking to the U.S. National Security Agency. 

- Infirm firmware
- Kaspersky’s most striking finding is Equation’s ability to infect the firmware of a hard drive, or the low-level code that acts as an interface between hardware and software. 

- The malware reprograms the hard drive’s firmware, creating hidden sectors on the drive that can only be accessed through a secret API (application programming interface). Once installed, the malware is impossible to remove: disk formatting and reinstalling the OS doesn’t affect it, and the hidden storage sector remains. 
- “Theoretically, we were aware of this possibility, but as far as I know this is the only case ever that we have seen of an attacker having such an incredibly advanced capability,” said Costin Raiu, director of Kaspersky Lab’s global research and analysis team, in a phone interview Monday. 

- Report link: http://25zbkz3k00wn2tp5092n6di7b5k.wpengine.netdna-cdn.com/files/2015/02/Equation_group_questions_and_answers.pdf 

- Source: PC World – Destroying your hard drive is the only way to stop this super advanced malware : http://www.pcworld.com/article/2884952/equation-cyberspies-use-unrivaled-nsastyle-techniques-to-hit-iran-russia.html 



---?image=/assets/images/slides/Slide46.JPG
@title[Unfettered Access to Hardware – Etc. ]
<p align="right"><span class="gold" ><b>Unfettered Access to Hardware – Etc.</b></span></p>
<br>

Note:

- Wifi image source:  https://commons.wikimedia.org/wiki/File%3AWIFI_icon.svg - By Canopus49 (Own work) [CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0)], via Wikimedia Commons

- NIC – Network interface controller

- EC –    embedded controllers 
- BMC – Baseboard Management Component



---?image=/assets/images/slides/Slide48_1.JPG
@title[Making System Unbootable (Bricking) ]
<p align="right"><span class="gold" ><b>Making System Unbootable (Bricking)</b></span></p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<p align="right"><span style="font-size:0.5em" ><a href="http://www.sophos.com/en-us/press-office/press-releases/1998/06/pr_uk_19980630cih.aspx">Source</a> : CIH virus, was first discovered in 1998</span></p>

Note:

- Source http://www.sophos.com/en-us/press-office/press-releases/1998/06/pr_uk_19980630cih.aspx
- The CIH virus, also known as Chernobyl, was first discovered in 1998, and quickly became one of the most commonly encountered viruses in the wild.

- CIH virus has the capacity to overwrite system start-up routines, as well as wiping data on hard disks. The virus attacks the BIOS, needed to boot up the computer, something which no previous virus has managed to do.


- The Real Chernobyl Nuclear melt down
- Before April 26th 1986, Chernobyl was a word hardly anybody ever heard. But within days it became the only word on peoples minds. In what was first passed off as "nothing" quickly escalated as reports from outside the Soviet Union filtered in what was to become the worst Nuclear Power Plant disaster in history.

- Chernobyl image sign source: https://farm6.staticflickr.com/5186/5661310269_0e42fa50ea_o_d.jpg
- Chernobyl areal view: http://crooksandliars.com/gordonskene/other-plans-gone-wrong-chernobyl-april


---?image=/assets/images/slides/Slide50.JPG
@title[Pre-Boot Threats ]
<br>
<br>
<p align="left"><span class="gold" ><b>Pre-Boot<br>Threats </b></span></p>

Note:


---?image=/assets/images/slides/Slide52.JPG
@title[Summary - Platform Firmware Security – Why is it important? ]
<p align="right"><span class="gold" ><b>Summary <br>Platform Firmware Security – Why is it important?</b></span></p>
<br>
<br>
<br>
<br>

Note:
There are several Firmware attack methods – and cyber hackers will be continually finding more. We need to be able to recognize where Firmware is vulnerable to help prevent attacks on firmware.<br>In Summary: This section is the “WHY WE ARE HERE”




